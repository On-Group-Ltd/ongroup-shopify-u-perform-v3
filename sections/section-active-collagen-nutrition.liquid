{{ 'section-nutrition-info.css' | asset_url | stylesheet_tag }}

<div class="nutrition-info-section" style="background-color: {{ section.settings.background_color }}; padding-top: {{ section.settings.padding_top }}px; padding-bottom: {{ section.settings.padding_bottom }}px;">
  <div class="nutrition-container">
    {% if section.settings.title != blank %}
      <h2 class="nutrition-title">{{ section.settings.title }}</h2>
    {% endif %}

    <div class="nutrition-stats">
      {% if section.settings.stat_1_number != blank or section.settings.stat_1_text != blank %}
        <div class="nutrition-stat">
          <div class="stat-number" data-target="{{ section.settings.stat_1_number }}">0</div>
          <div class="stat-text">{{ section.settings.stat_1_text }}</div>
        </div>
      {% endif %}

      {% if section.settings.stat_2_number != blank or section.settings.stat_2_text != blank %}
        <div class="nutrition-stat">
          <div class="stat-number" data-target="{{ section.settings.stat_2_number }}">0</div>
          <div class="stat-text">{{ section.settings.stat_2_text }}</div>
        </div>
      {% endif %}

      {% if section.settings.stat_3_number != blank or section.settings.stat_3_text != blank %}
        <div class="nutrition-stat">
          <div class="stat-number" data-target="{{ section.settings.stat_3_number }}">0</div>
          <div class="stat-text">{{ section.settings.stat_3_text }}</div>
        </div>
      {% endif %}
    </div>

    {% if section.settings.description != blank %}
      <div class="nutrition-description">{{ section.settings.description }}</div>
    {% endif %}
  </div>
</div>

<style>
.nutrition-info-section {
  width: 100%;
}

.nutrition-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 20px;
  text-align: center;
}

.nutrition-title {
  font-size: clamp(2rem, 6.75vw, 7.2rem);
  font-weight: 400;
  margin-bottom: 60px;
  color: {{ section.settings.title_color }};
  font-family: "georgiapro", sans-serif;
}

.nutrition-title span {
  color: #857550;
}

.nutrition-stats {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: clamp(40px, 8vw, 120px);
  flex-wrap: wrap;
  margin-bottom: 40px;
}

.nutrition-stat {
  display: flex;
  flex-direction: column;
  align-items: center;
  flex: 0 1 220px;
}

.stat-number {
  font-size: clamp(3rem, 15vw, 18rem);
  font-weight: 900;
  color: {{ section.settings.stat_number_color }};
    margin-bottom: 10px;
    line-height: 1;
    letter-spacing: -11px;
    font-family: sans-serif;
}

.stat-text {
  font-size: clamp(1rem, 2vw, 2.5rem);
  color: {{ section.settings.stat_text_color }};
  line-height: 1.4;
}

.nutrition-description {
  font-size: clamp(0.875rem, 1.5vw, 2.5rem);
  color: {{ section.settings.description_color }};
  max-width: 800px;
  margin: 0 auto;
  line-height: 1.6;
}

@media (max-width: 768px) {
  .nutrition-stats {
    justify-content: center;
    gap: 40px;
  }
  .nutrition-stats .stat-number {
    font-size: clamp(3rem, 30vw, 15rem);
  }
  .nutrition-stats .stat-text {
    font-size: clamp(1rem, 5vw, 2.5rem);
  }
  .nutrition-description {
    font-size: clamp(0.875rem, 5vw, 2.5rem);
  }
}

@media (max-width: 767px) {
  .nutrition-title {
    
  }
  .nutrition-stats .nutrition-stat {
    flex: 0 1 170px;
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const nutritionSection = document.querySelector('.nutrition-info-section');
  const statNumbers = document.querySelectorAll('.stat-number');
  let hasAnimated = false;

  // Function to parse number from string (handles units like g, mg, %, etc)
  function parseNumber(str) {
    const match = str.match(/[\d.]+/);
    return match ? parseFloat(match[0]) : 0;
  }

  // Function to get the unit/suffix from string
  function getUnit(str) {
    return str.replace(/[\d.\s]/g, '');
  }

  // Function to animate counting
  function animateCounter(element, target, duration = 2000) {
    const targetNum = parseNumber(target);
    const unit = getUnit(target);
    const startTime = performance.now();
    const startValue = 0;

    // Determine if we should use decimals
    const hasDecimals = target.includes('.');
    const decimals = hasDecimals ? (target.split('.')[1] || '').length : 0;

    function updateCounter(currentTime) {
      const elapsed = currentTime - startTime;
      const progress = Math.min(elapsed / duration, 1);

      // Easing function for smooth animation (easeOutExpo)
      const easeProgress = progress === 1 ? 1 : 1 - Math.pow(2, -10 * progress);

      const currentValue = startValue + (targetNum - startValue) * easeProgress;

      // Format the number
      const displayValue = decimals > 0
        ? currentValue.toFixed(decimals)
        : Math.floor(currentValue);

      element.textContent = displayValue + unit;

      if (progress < 1) {
        requestAnimationFrame(updateCounter);
      } else {
        element.textContent = target; // Ensure final value is exact
      }
    }

    requestAnimationFrame(updateCounter);
  }

  // Intersection Observer to trigger animation when section is visible
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting && !hasAnimated) {
        hasAnimated = true;

        statNumbers.forEach(statNumber => {
          const target = statNumber.getAttribute('data-target');
          if (target) {
            animateCounter(statNumber, target);
          }
        });
      }
    });
  }, {
    threshold: 0.3 // Trigger when 30% of the section is visible
  });

  if (nutritionSection) {
    observer.observe(nutritionSection);
  }
});
</script>

{% schema %}
{
  "name": "Nutrition Info",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Section Title",
      "default": "Active Collagen."
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Title Color",
      "default": "#FFFFFF"
    },
    {
      "type": "header",
      "content": "Stat 1"
    },
    {
      "type": "text",
      "id": "stat_1_number",
      "label": "Stat 1 Number",
      "default": "10g"
    },
    {
      "type": "text",
      "id": "stat_1_text",
      "label": "Stat 1 Text",
      "default": "Collagen per serving"
    },
    {
      "type": "header",
      "content": "Stat 2"
    },
    {
      "type": "text",
      "id": "stat_2_number",
      "label": "Stat 2 Number",
      "default": "100%"
    },
    {
      "type": "text",
      "id": "stat_2_text",
      "label": "Stat 2 Text",
      "default": "Natural ingredients"
    },
    {
      "type": "header",
      "content": "Stat 3"
    },
    {
      "type": "text",
      "id": "stat_3_number",
      "label": "Stat 3 Number",
      "default": "0g"
    },
    {
      "type": "text",
      "id": "stat_3_text",
      "label": "Stat 3 Text",
      "default": "Sugar"
    },
    {
      "type": "color",
      "id": "stat_number_color",
      "label": "Stat Number Color",
      "default": "#857550"
    },
    {
      "type": "color",
      "id": "stat_text_color",
      "label": "Stat Text Color",
      "default": "#FFFFFF"
    },
    {
      "type": "header",
      "content": "Description"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Bottom Description",
      "default": "<p>Per 30ml Sachet</p>"
    },
    {
      "type": "color",
      "id": "description_color",
      "label": "Description Color",
      "default": "#FFFFFF"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#000000"
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 200,
      "step": 5,
      "unit": "px",
      "label": "Padding Top",
      "default": 80
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 200,
      "step": 5,
      "unit": "px",
      "label": "Padding Bottom",
      "default": 80
    }
  ],
  "presets": [
    {
      "name": "Nutrition Info"
    }
  ]
}
{% endschema %}
